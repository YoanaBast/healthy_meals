{% extends 'base.html' %}
{% load static %}
{% block title %}Add Ingredient{% endblock %}

{% block content %}
<link rel="stylesheet" href="{% static 'css/ingredient_forms_styles.css' %}">


<div class="container-content">
    <div style="display: flex; gap: 0.5rem; flex-wrap: wrap;">
        <a href="javascript:history.back()" class="btn">Back</a>
    </div>
</div>

<div class="container-content">
    <h2>Add Ingredient</h2>

    <div class="grid-container">
        <div class="grid-item info">

            <form id="add-ingredient-form" method="post" action="{% url 'add_ingredient' %}" novalidate>
                {% csrf_token %}
                {% include "core/errors_label.html" %}

                {{ form.name.label_tag }} {{ form.name }}

                {{ form.category.label_tag }}
                <div style="display:flex; align-items:center; gap:0.4rem; margin-bottom:0.5rem;">
                    {{ form.category }}
                    <button type="button" class="btn btn-small" title="Add new category"
                        onclick="openQuickModal('Add Category', '{% url "add_category_ajax" %}', 'id_category')">+</button>
                    <button type="button" class="btn btn-small" title="Manage categories"
                        onclick="fetchAndManage('{% url "list_categories_ajax" %}', 'Manage Categories')">⋯</button>
                </div>

                <div style="display:flex; align-items:center; gap:0.4rem; margin-bottom:0.25rem;">
                    {{ form.dietary_tag.label_tag }}
                    <button type="button" class="btn btn-small" title="Add new dietary tag"
                        onclick="openQuickModal('Add Dietary Tag', '{% url "add_dietary_tag_ajax" %}', 'id_dietary_tag')">+</button>
                    <button type="button" class="btn btn-small" title="Manage dietary tags"
                        onclick="fetchAndManage('{% url "list_dietary_tags_ajax" %}', 'Manage Dietary Tags')">⋯</button>
                </div>
                {{ form.dietary_tag }}

        </div>

        <div class="grid-item info">
            <p class="small-gray">This is the reference amount all nutrient values are calculated for. For example, if base quantity is 100g, all nutrients below represent what's in 100g of this ingredient.</p>
                <br>
            {{ form.base_quantity.label_tag }} {{ form.base_quantity }}


            {{ form.default_unit.label_tag }}
            <div style="display:flex; align-items:center; gap:0.4rem;">
                {{ form.default_unit }}
                <button type="button" class="btn btn-small" title="Create new unit"
                    onclick="openQuickModal(
                        'Create Measurement Unit',
                        '{% url "add_measurement_unit_ajax" %}',
                        'id_default_unit',
                        [{key:'code', placeholder:'Code (e.g. g, ml, pc)'},
                         {key:'name_singular', placeholder:'Singular (e.g. gram)'},
                         {key:'name_plural', placeholder:'Plural (e.g. grams)'}]
                    )">+</button>
                <button type="button" class="btn btn-small" title="Manage units"
                    onclick="fetchAndManage('{% url "list_measurement_units_ajax" %}', 'Manage Units')">⋯</button>
            </div>

        </div>
    </div>

    <div class="nutrients-grid">
        {% for nutrient in form %}
            {% if "base_quantity_" in nutrient.name and nutrient.name != "base_quantity" %}
            <div class="nutrient-item">
                {{ nutrient.label_tag }} {{ nutrient }}
            </div>
            {% endif %}
        {% endfor %}
    </div>

    <div style="display: flex; gap: 0.5rem; flex-wrap: wrap; justify-content: flex-start; margin-top: 1rem;">
        <button type="submit" class="btn">Save</button>
        <a href="{% url 'manage_ingredients' %}" class="btn btn-danger">Cancel</a>
    </div>

    </form>
</div>

{% include 'core/_quick_add_modal.html' %}
{% include 'core/_manage_list_modal.html' %}

<script src="{% static 'js/zero_inputt_handler.js' %}"></script>
<script src="{% static 'js/fetch_and_manage.js' %}"></script>


{% endblock %}