{% extends 'base.html' %}
{% load static %}
{% load recipe_extras %}
{% load core_filters %}

{% block title %}{{ ingredient.name }} Details{% endblock %}

{% block content %}

<div class="container-content">
    <div style="display: flex; gap: 0.5rem; flex-wrap: wrap;">
        <a href="javascript:history.back()" class="btn">Back</a>
        <a href="{% url 'edit_ingredient' ingredient.id %}" class="btn">Edit</a>
        <a href="{% url 'manage_ingredients' %}" class="btn">All Ingredients</a>
    </div>
    <button class="btn btn-danger" style="margin-left: auto;" onclick="openDeleteModal('ingredient', {{ ingredient.id }}, '{{ ingredient.name|escapejs }}')">Delete</button>
</div>


{% include 'ingredients/delete_ingredient_modal.html' %}

<div class="container-content">
    <div class="grid-container">
        <div class="grid-item info">
                <h1 class="section-title">{{ ingredient.name|title_except }} </h1>

<!-- Details Table -->
                <table class="data-table">
                    <tbody>
                        <tr>
                            <th>Category</th>
                            <td>{{ ingredient.category|default:"-" }}</td>
                        </tr>
                        <tr>
                            <th>Base Quantity</th>
                            <td>{{ ingredient.base_quantity }}</td>
                        </tr>
                        <tr>
                            <th>Default Unit</th>
                            <td>{{ ingredient.default_unit|default:"-" }}</td>
                        </tr>


                    <tr>
                        <th>All Units</th>
                        <td>
                            {% for mu in ingredient.measurement_units.all %}
                                {{ mu.unit.name_singular }} ({{ mu.unit.code }}) â€” {{ mu.conversion_to_base }} per base
                                {% if not forloop.last %}<br>{% endif %}
                            {% empty %}
                                -
                            {% endfor %}
                        </td>
                    </tr>
                        <tr>
                            <th>Dietary Information</th>
                            <td>{{ ingredient.dietary_info|default:"-" }}</td>
                        </tr>
                    </tbody>
                </table>
</div>

<!-- Unit Selection  -->

        <div class="grid-item info">
            <div class="nutrients-section" style="display: flex; flex-direction: column; gap: 1.5rem;">
                <!-- Form on top -->
<form method="post" class="styled-form">
    {% csrf_token %}
    <div class="form-group">
        <label>Measurement unit:</label>
        <select name="unit">
            {% for mu in ingredient.measurement_units.all %}
                <option value="{{ mu.id }}" {% if mu == selected_imu %}selected{% endif %}>
                    {{ mu.unit.name_singular }} ({{ mu.unit.code }})
                </option>
            {% empty %}
                <option disabled>No units defined</option>
            {% endfor %}
        </select>
    </div>
    <div class="form-group">
        <input type="number" name="quantity" step="0.01" required placeholder="Quantity" value="{{ quantity }}">
    </div>
    <button type="submit" class="btn btn-secondary btn-small">Update</button>
</form>
</div> </div>

<!-- nutrients table -->
    <div class="nutrients-tables">
        <h2 style="font-size: 18px;">Nutrients for {{ quantity }} {{ unit_name }}:</h2>
        <table class="nutrients-table">
            <thead>
                <tr><th>Nutrient</th><th>Amount</th></tr>
            </thead>
            <tbody>
                {% for n, value in nutrients.items %}
                    <tr>
                        <td>{{ n|nice_name }}</td>
                        <td>{{ value }}</td>
                    </tr>
                {% empty %}
                    <tr><td colspan="2">No nutrient info.</td></tr>
                {% endfor %}
            </tbody>
        </table>



    </div>

    <br>
    <div style="display: flex; gap: 0.5rem; flex-wrap: wrap;">
        <a href="javascript:history.back()" class="btn">Back</a>
        <a href="{% url 'manage_ingredients' %}" class="btn">All Ingredients</a>
    </div>


<style>
.nutrients-tables {
    display: grid;
    grid-template-columns: 1fr;
    gap: 2rem;
    margin-left: 0;   /* left-align the table */
    max-width: 500px;      /* adjust width */
}

.nutrients-table {
    width: 100%;
    border-collapse: collapse;
    background: #111;
    color: #fff;
}
.nutrients-table th, .nutrients-table td {
    border: 1px solid #444;
    padding: 0.5rem 1rem;
    text-align: left;
}
.nutrients-table th { background: #222; }


</style>
<script src="{% static 'js/delete_popup.js' %}"></script>

{% endblock %}
