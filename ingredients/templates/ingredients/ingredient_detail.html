{% extends 'base.html' %}
{% load static %}
{% load recipe_extras %}

{% block title %}{{ ingredient.name }} Details{% endblock %}

{% block content %}

<div class="container-home" style="max-width: 800px; margin: 2rem auto; display: flex; gap: 0.5rem; flex-wrap: wrap; align-items: center;">
    <div style="display: flex; gap: 0.5rem; flex-wrap: wrap;">
        <a href="javascript:history.back()" class="btn">Back</a>
        <a href="{% url 'edit_ingredient' ingredient.id %}" class="btn">Edit</a>
    </div>
    <button class="btn btn-danger" style="margin-left: auto;" onclick="openDeleteModal('ingredient', {{ ingredient.id }}, '{{ ingredient.name|escapejs }}')">Delete</button>
</div>

{% include 'ingredients/delete_ingredient_modal.html' %}

<div class="container-home">

    <div class="section-header" style="display:flex; justify-content:space-between; align-items:center; margin-bottom:2rem;">
        <div>
            <h1 class="section-title">{{ ingredient.name }} </h1>
            <p class="section-description">View detailed information about this ingredient.</p>
        </div>
    </div>

    <!-- Details Table -->
    <table class="data-table">
        <tbody>

            <tr>
                <th>Category</th>
                <td>{{ ingredient.category|default:"-" }}</td>
            </tr>
            <tr>
                <th>Base Quantity</th>
                <td>{{ ingredient.base_quantity }}</td>
            </tr>
            <tr>
                <th>Default Unit</th>
                <td>{{ ingredient.default_unit|default:"-" }}</td>
            </tr>
            <tr>
                <th>Dietary Information</th>
                <td>{{ ingredient.dietary_info|default:"-" }}</td>
            </tr>
        </tbody>
    </table>

    <!-- Unit Selection & Nutrients Table -->
    <h4 style="margin-top: 2rem;">
        Nutrients for {{ quantity }} {{ unit_name }}:
    </h4>

<form method="post" class="styled-form">
    {% csrf_token %}

    {{ form.as_p }}

    <div class="form-group">
        <label>Measurement unit:</label>
        <select name="unit">
            {% for mu in ingredient.measurement_units.all %}
                <option value="{{ mu.id }}">{{ mu.unit }}</option>
            {% endfor %}
        </select>
    </div>

    <div class="form-group">
        <input type="number" name="quantity" step="0.01" required placeholder="Quantity">
    </div>

    <button type="submit" class="btn btn-secondary btn-small">Update</button>
</form>



<div class="nutrients-tables">
    <table class="nutrients-table">
        <thead>
            <tr><th>Nutrient</th><th>Amount</th></tr>
        </thead>
        <tbody>
            {% for n, value in nutrients.items %}
                <tr>
                    <td>{{ n|nice_name }}</td>
                    <td>{{ value }}</td>
                </tr>
            {% empty %}
                <tr><td colspan="2">No nutrient info.</td></tr>
            {% endfor %}
        </tbody>
    </table>
</div>


</div>
<style>
.nutrients-tables {
    display: grid;
    grid-template-columns: 1fr;
    gap: 2rem;
    margin-left: 0;   /* left-align the table */
    max-width: 500px;      /* adjust width */
}

.nutrients-table {
    width: 100%;
    border-collapse: collapse;
    background: #111;
    color: #fff;
}
.nutrients-table th, .nutrients-table td {
    border: 1px solid #444;
    padding: 0.5rem 1rem;
    text-align: left;
}
.nutrients-table th { background: #222; }


</style>
<script src="{% static 'js/delete_popup.js' %}"></script>

{% endblock %}
