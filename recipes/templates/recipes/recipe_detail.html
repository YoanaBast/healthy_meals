{% extends 'base.html' %}
{% load static %}
{% load recipe_extras %}
{% block title %}{{ recipe.name }}{% endblock %}

{% block content %}
<div class="container-home" style="max-width: 800px; margin: 2rem auto; display: flex; gap: 0.5rem; flex-wrap: wrap; align-items: center;">
    <div style="display: flex; gap: 0.5rem; flex-wrap: wrap;">
        <a href="{% url 'manage_recipes' %}" class="btn">&larr; Back to Recipes</a>
        <a href="{% url 'edit_recipe' recipe.pk %}" class="btn">Edit</a>
    </div>
    <button class="btn btn-danger" style="margin-left: auto;" onclick="openDeleteModal('recipe', {{ recipe.pk }}, '{{ recipe.name|escapejs }}')">Delete</button>
</div>

    {% include 'recipes/delete_recipe_modal.html' %}

    <!-- Info + Ingredients Grid -->
<div class="container-home" style="max-width: 800px; margin: 2rem auto;">
    <div class="grid-container">
        <div class="grid-item info">
            <h1>{{ recipe.name }}</h1>
            <p><strong>Category:</strong> {{ recipe.category|default:"-" }}</p>
            <p><strong>Dietary Info:</strong> {{ recipe.dietary_info|default:"-" }}</p>
            <p><strong>Cooking Duration:</strong> {{ recipe.cooking_duration|default:"-" }}</p>
            <p><strong>Kcal per Serving:</strong> {{ recipe.kcal_per_serving|default:"-" }}</p>
            <p><strong>Servings:</strong> {{ recipe.servings|default:"-" }}</p>
        </div>
        <div class="grid-item ingredients">
            <h2>Ingredients</h2>
            <ul>
              {% for ing, qtys in recipe.quantity_ingredients_list_all_units %}
                  <li>{{ ing.name }} â€” {{ qtys }}</li>
              {% empty %}
                  <li>No ingredients added.</li>
              {% endfor %}
            </ul>
        </div>
    </div>

    <h2>Instructions</h2>
    <p>{{ recipe.instructions|linebreaks }}</p>

    <!-- Nutrients Grid -->
<div class="nutrients-tables">
    <table class="nutrients-table">
        <thead>
            <tr><th colspan="2">Nutrients (Per Serving - 1/{{ recipe.servings|default:"-" }}) </th></tr>
        </thead>
        <tbody>
            {% for nutrient, value in recipe.nutrients_per_serving_with_units.items %}
                <tr>
                    <td>{{ nutrient|nice_name }}</td>
                    <td>{{ value }}</td>
                </tr>
            {% empty %}
                <tr><td colspan="2">No nutrient info.</td></tr>
            {% endfor %}
        </tbody>
    </table>

    <table class="nutrients-table">
        <thead>
            <tr><th colspan="2">Nutrients (Total)</th></tr>
        </thead>
        <tbody>
            {% for nutrient, value in recipe.nutrients_with_units.items %}
                <tr>
                    <td>{{ nutrient|nice_name }}</td>
                    <td>{{ value }}</td>
                </tr>
            {% empty %}
                <tr><td colspan="2">No nutrient info.</td></tr>
            {% endfor %}
        </tbody>
    </table>
</div>

<style>
.nutrients-tables {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 2rem;
    margin-top: 2rem;
}
.nutrients-table {
    width: 100%;
    border-collapse: collapse;
    background: #111;
    color: #fff;
}
.nutrients-table th, .nutrients-table td {
    border: 1px solid #444;
    padding: 0.5rem 1rem;
    text-align: left;
}
.nutrients-table th {
    background: #222;
}
@media (max-width: 768px) {
    .nutrients-tables {
        grid-template-columns: 1fr;
    }
}

.grid-container {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 2rem;
    margin-bottom: 2rem;
}
.grid-item {
    background: #111; /* optional for better separation */
    padding: 1rem;
    border-radius: 6px;
}
.info p, .ingredients ul, .nutrients ul {
    margin: 0.3rem 0;
}
.nutrients ul, .ingredients ul {
    padding-left: 1.5rem;
}
.btn { display: inline-block; padding: 0.5rem 1rem; background: #333; color: #fff; border-radius: 4px; text-decoration: none; margin-right: 0.5rem; }

@media (max-width: 768px) {
    .grid-container {
        grid-template-columns: 1fr;
    }
}
</style>

<script src="{% static 'js/delete_popup.js' %}"></script>

{% endblock %}
