{% extends 'base.html' %}
{% load static %}
{% load recipe_extras %}
{% load core_filters %}

{% block title %}{{ recipe.name }}{% endblock %}

{% block content %}
<link rel="stylesheet" href="{% static 'css/recipe_styles.css' %}">


<div class="container-home" style="max-width: 800px; margin: 2rem auto; display: flex; gap: 0.5rem; flex-wrap: wrap; align-items: center;">
    <div style="display: flex; gap: 0.5rem; flex-wrap: wrap;">
        <a href="javascript:history.back()" class="btn">← Back</a>
        <a href="{% url 'edit_recipe' recipe.pk %}" class="btn">Edit</a>
        <a href="{% url 'manage_recipes' %}" class="btn">All Recipes</a>
    </div>

    <button class="btn btn-danger" style="margin-left: auto;" onclick="openDeleteModal('recipe', {{ recipe.pk }}, '{{ recipe.name|escapejs }}')">Delete</button>
</div>


    {% include 'recipes/delete_recipe_modal.html' %}

    <!-- Info + Ingredients Grid -->
<div class="container-home" style="max-width: 800px; margin: 2rem auto;">
    <div class="grid-container">
        <div class="grid-item info">
            <h1>{{ recipe.name|title_except }}</h1>
            <p><strong>Category:</strong> {{ recipe.category|default:"-" }}</p>
            <p><strong>Dietary Info:</strong> {{ recipe.dietary_info|default:"-" }}</p>
            <p><strong>Cooking Duration:</strong> {{ recipe.cooking_duration|default:"-" }}</p>
            <p><strong>Kcal per Serving:</strong> {{ recipe.kcal_per_serving|default:"-" }}</p>
            <p><strong>Servings:</strong> {{ recipe.servings|default:"-" }}</p>
        </div>
        <div class="grid-item ingredients">
            <h2>Ingredients</h2>
            <ul>
              {% for ing, qtys in recipe.quantity_ingredients_list_all_units %}
                  <li>{{ ing.name }} — {{ qtys }}</li>
              {% empty %}
                  <li>No ingredients added.</li>
              {% endfor %}
            </ul>
        </div>
    </div>

    <h2>Instructions</h2>
    <p>{{ recipe.instructions|linebreaks }}</p>

    <!-- Nutrients Grid -->
<div class="nutrients-tables">
    <table class="nutrients-table">
        <thead>
            <tr><th colspan="2">Nutrients (Per Serving - 1/{{ recipe.servings|default:"-" }}) </th></tr>
        </thead>
        <tbody>
            {% for nutrient, value in recipe.nutrients_per_serving_with_units.items %}
                <tr>
                    <td>{{ nutrient|nice_name }}</td>
                    <td>{{ value }}</td>
                </tr>
            {% empty %}
                <tr><td colspan="2">No nutrient info.</td></tr>
            {% endfor %}
        </tbody>
    </table>

    <table class="nutrients-table">
        <thead>
            <tr><th colspan="2">Nutrients (Total)</th></tr>
        </thead>
        <tbody>
            {% for nutrient, value in recipe.nutrients_with_units.items %}
                <tr>
                    <td>{{ nutrient|nice_name }}</td>
                    <td>{{ value }}</td>
                </tr>
            {% empty %}
                <tr><td colspan="2">No nutrient info.</td></tr>
            {% endfor %}
        </tbody>
    </table>
</div>

    <div style="max-width: 800px; margin: 2rem auto;">
        <a href="javascript:history.back()" class="btn">← Back</a>
        <a href="{% url 'manage_recipes' %}" class="btn">All Recipes</a>
    </div>



<script src="{% static 'js/delete_popup.js' %}"></script>

{% endblock %}
